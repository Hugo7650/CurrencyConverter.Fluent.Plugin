using Blast.API.Settings;using Blast.Core.Objects;namespace CurrencyConverter.Fluent.Plugin{    public class CurrencyConverterSearchAppSettings : SearchApplicationSettingsPage    {        private readonly List<CurrencyItem> _popularCurrencies =            CurrencyItemsCollectionSettingManager.GetDefaultCurrencies();        private string _selectedLanguage = LanguageManager.Instance.CurrentLanguage;        public CurrencyConverterSearchAppSettings(SearchApplicationInfo searchApplicationInfo) : base(searchApplicationInfo)        {        }        [Setting(Name = nameof(SelectedLanguage), DisplayedName = "Language",            Description = "Select language for currency names", IconGlyph = "\uE774",            SettingManagerType = typeof(LanguageSettingManager))]        public string SelectedLanguage        {            get => _selectedLanguage;            set            {                if (_selectedLanguage != value)                {                    _selectedLanguage = value;                    LanguageManager.Instance.SetLanguage(value);                    OnPropertyChanged();                }            }        }        [Setting(Name = nameof(PopularCurrencies), DisplayedName = "Popular currencies",            Description = "Configure popular currencies for additional conversion options", IconGlyph = "\uE8AB",            SettingManagerType = typeof(CurrencyItemsCollectionSettingManager))]        public List<CurrencyItem> PopularCurrencies        {            get => _popularCurrencies;            set            {                foreach (CurrencyItem currencyItem in value)                {                    CurrencyItem? firstOrDefault = _popularCurrencies                        .FirstOrDefault(s => s.Code.Equals(currencyItem.Code, StringComparison.OrdinalIgnoreCase));                    if (firstOrDefault == null)                        _popularCurrencies.Add(currencyItem);                    else                        firstOrDefault.IsEnabled = currencyItem.IsEnabled;                }            }        }        public class LanguageSettingManager : ListSelection        {            public LanguageSettingManager()            {                var languageManager = LanguageManager.Instance;                                Items = languageManager.SupportedLanguages                    .Select(kvp => $"{kvp.Value} ({kvp.Key})")                    .ToList()                    .AsReadOnly();                var currentLanguage = languageManager.CurrentLanguage;                var currentLanguageName = languageManager.SupportedLanguages[currentLanguage];                SelectedItem = $"{currentLanguageName} ({currentLanguage})";            }            public LanguageSettingManager(LanguageSettingManager other) : base(other)            {            }            public static string ExtractLanguageCode(string displayValue)            {                if (string.IsNullOrEmpty(displayValue))                    return "en";                var lastOpenParen = displayValue.LastIndexOf('(');                var lastCloseParen = displayValue.LastIndexOf(')');                                if (lastOpenParen > 0 && lastCloseParen > lastOpenParen)                {                    return displayValue.Substring(lastOpenParen + 1, lastCloseParen - lastOpenParen - 1);                }                return "en";            }        }        public class CurrencyItemsCollectionSettingManager : CollectionSettingManager<CurrencyItem>        {            public override IList<CurrencyItem> GetDefaultValue()            {                return GetDefaultCurrencies();            }            internal static List<CurrencyItem> GetDefaultCurrencies()            {                var languageManager = LanguageManager.Instance;                return new List<CurrencyItem>                {                    new CurrencyItem { Code = "USD", IsEnabled = true },                    new CurrencyItem { Code = "EUR", IsEnabled = true },                    new CurrencyItem { Code = "GBP", IsEnabled = true },                    new CurrencyItem { Code = "JPY", IsEnabled = true },                    new CurrencyItem { Code = "CAD", IsEnabled = true },                    new CurrencyItem { Code = "AUD", IsEnabled = true },                    new CurrencyItem { Code = "CHF", IsEnabled = true },                    new CurrencyItem { Code = "CNY", IsEnabled = true },                    new CurrencyItem { Code = "SEK", IsEnabled = true },                    new CurrencyItem { Code = "NOK", IsEnabled = true },                    new CurrencyItem { Code = "KRW", IsEnabled = true },                    new CurrencyItem { Code = "SGD", IsEnabled = true },                    new CurrencyItem { Code = "HKD", IsEnabled = true },                    new CurrencyItem { Code = "INR", IsEnabled = true },                    new CurrencyItem { Code = "BRL", IsEnabled = true }                };            }        }    }}